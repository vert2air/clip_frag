// ============================================================================
// main.rs
// ============================================================================
//
// このファイルは clip_frag アプリケーションのエントリポイントである。
// 責務は以下の 3 点のみとし、ロジックは app/ 以下に委譲する:
//
//   1. CLI 引数のパース（clap）
//   2. App 構造体の初期化
//   3. app.run() によるアプリケーション本体の実行
//
// これにより main.rs は非常に読みやすく、保守性が高くなる。
// ============================================================================

mod app;

use clap::Parser;
use anyhow::Result;

// -----------------------------------------------------------------------------
// CLI 引数定義
// -----------------------------------------------------------------------------
//
// clip_frag [-c <文字数>|-b <byte数>] [<入力ファイル名>]
//
// -c と -b は排他的
// 入力ファイル名が指定されない場合は標準入力を使用する
//
#[derive(Parser, Debug)]
#[command(name = "clip_frag")]
#[command(about = "LLM 用にテキストを分割しながらクリップボードに送る CLI")]
pub struct Cli {
    /// 一回に取り込む最大文字数
    #[arg(short = 'c', value_name = "文字数", conflicts_with = "bytes")]
    pub chars: Option<usize>,

    /// 一回に取り込む最大バイト数
    #[arg(short = 'b', value_name = "byte数", conflicts_with = "chars")]
    pub bytes: Option<usize>,

    /// 入力ファイル名（省略時は標準入力）
    #[arg(value_name = "入力ファイル名")]
    pub input_file: Option<std::path::PathBuf>,
}

// -----------------------------------------------------------------------------
// main 関数
// -----------------------------------------------------------------------------
fn main() -> Result<()> {
    // CLI 引数をパース
    let cli = Cli::parse();

    // App を初期化
    let mut app = app::App::new(cli)?;

    // アプリケーション本体を実行
    app.run()?;

    Ok(())
}
