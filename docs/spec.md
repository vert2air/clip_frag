# 分割clip

## 機能概要

本アプリは、CLIアプリケーションである。

本アプリでは、入力として与えられた
行指向テキストファイル (以下、単に「入力ファイル」と呼ぶ) を
clipボードに取り込む。
また、一回に取り込む最大データ量を定め、
入力ファイルのデータ量が、一回に取り込む最大データ量を超える場合、
簡単なキーボード操作のみで、
分割しながらclipボードに取り込むことを可能にする。

## 想定するユースケース

LLMのチャット画面からソースコード等を読み込ませたい場合に、
一回に入力できる文字数に制限があるケース。
本プリにより、
制限に合うように自動で分割しながら、簡単にpaste出来るデータを作り出せる。

## 機能詳細

### 分割データ

一回に取り込む最大のデータ量は、CLIオプションで与えることが出来る。
文字数、又は、byte数を指定することが出来る。Defaultは、10,240文字とする。

一回に取り込むデータは、上記の最大のデータ量の制約の他に、
行が途中で分割されることが無いようにする。
つまり、行は、全体を含むか、全く含まないかのどちらかであり、
次の行を含めると最大のデータ量を超える場合は、その行は含めない。

### アプリの動作

#### 主要な状態データ

prev_contents:
直前に取り込んだデータ

curr_index:
次に取り込むべきデータの入力ファイル中のindex。

#### アプリの起動

本アプリに入力ファイル名を与えると、
以下のヘッダプロンプトがclipboardに取り込まれる。
この内容を、prev_contents に記憶する。

```text
以下に、ファイル: <入力ファイル名> を入力します。
---
```

入力ファイルのエンコードを判定する。
想定されるエンコードは、UTF-8 又は shift-jis である。
判定出来た時点で、標準エラー出力に判定結果を出力する。

また、curr_index に 0 を設定する。

#### アプリの本体のループ処理
入力ファイルの curr_index から、
行単位で区切りながら、一回に取り込む最大のデータ量を超えることのない範囲で、
何行取り込むかを決定する。

新たに取り込むデータ量を算出する。
一回に取り込む最大のデータ量が文字数で決まる場合、文字数で、
byte数で決まる場合は、byte数を単位とする。

標準エラー出力に、以下のプロンプトを表示する。

```text
+10_240 [chars] (25.0 %), 10_240 / 40_960 (25.0 %): Y(es)/P(rev)/Q(uit) [y]:
```

プロンプトは、以下のデータから構成されている。
・取り込むデータ量
・[データ量の単位]
・入力ファイル全体に対する百分率
・今回のデータを処理することで、累積のデータ量が幾らになるか。
・入力ファイル全体のデータ量。
・累積のデータ量の入力ファイル全体に対する百分率
・次の動作の選択肢:
　・次のデータをclipboardに取り込む。[y or Y or yes or リターンのみ]
　・直前のデータを再度clipboardに取り込む。[p or P or prev]
　・アプリを終了する。[q or Q or quit]

標準入力から、行単位でユーザからの入力を受け取る。

Yesの場合、
- 新たに取り込むデータをclipboardに取り込む。
- 新たに取り込むデータをprev_contents に格納する。
- curr_index を進める。
- curr_index が入力ファイルの末尾に達した場合、最終フラグメント処理に進む。
  それ以外の場合、再度、アプリの本体のループ処理 を実行する。

Prevの場合、
- prev_contentsをclipboardに取り込む。
- 再度、アプリの本体のループ処理 を実行する。

quitの場合
- clipboardをクリアする。
- アプリケーションを停止する。

#### ファイナライズ処理

プロンプトは以下にする。

```text
+footer prompt: Y(es)/P(rev)/Q(uit) [y]:
```

標準入力から、行単位でユーザからの入力を受け取る。

yes が選択された場合、clipboardに以下を取り込む。
```text
以上が、ファイル: <入力ファイル名> の内容である。
```
また、上記のデータを prev_contents に格納する。

prev が選択された場合、
- prev_contentsをclipboardに取り込む。
- 再度、クローズ処理 を実行する。

quitの場合
- clipboardをクリアする。
- アプリケーションを停止する。

#### 終了処理

プロンプトは以下とする。

```text
P(rev)/Q(uit) [q]:
```

prev が選択された場合、
- prev_contentsをclipboardに取り込む。
- 再度、終了処理 を実行する。

quitの場合
- clipboardをクリアする。
- アプリケーションを停止する。

## CLIコマンド仕様

### CLIコマンド引数

```bash
clip_frag [-c <文字数>|-b <byte数>] <入力ファイル名>
```
